

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pymapmanager.interface.mmCanvas &mdash; PyMapManager a1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="PyMapManager a1 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> PyMapManager
          

          
          </a>

          
            
            
              <div class="version">
                Version 0a1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">PyMapManager</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>pymapmanager.interface.mmCanvas</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pymapmanager.interface.mmCanvas</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module implements canvas classes to do the drawing inside PyMapManager windows</span>

<span class="sd">    StackImageCanvase: Canvas to display and interact with an 3D image volume (stack)</span>

<span class="sd">    mapplotcanvas:</span>
<span class="sd">    stackplotcanvas:</span>
<span class="sd">    segmentplotcanvas:</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="k">import</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtCore</span>

<span class="kn">from</span> <span class="nn">matplotlib.backends.backend_qt4agg</span> <span class="k">import</span> <span class="n">FigureCanvasQTAgg</span> <span class="k">as</span> <span class="n">FigureCanvas</span>
<span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="k">import</span> <span class="n">Figure</span>

<span class="kn">from</span> <span class="nn">pymapmanager.mmUtil</span> <span class="k">import</span> <span class="n">mmEvent</span><span class="p">,</span> <span class="n">newplotdict</span>
<span class="kn">from</span> <span class="nn">pymapmanager.mmMapPlot2</span> <span class="k">import</span> <span class="n">mmMapPlot2</span>

<div class="viewcode-block" id="mmCanvas"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmCanvas">[docs]</a><span class="k">class</span> <span class="nc">mmCanvas</span><span class="p">(</span><span class="n">FigureCanvas</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A figure canvas that holds a matplotlib figure. User actions are linked to this canvas with mpl_connect. This canvas must have Qt.ClickFocus to receive user events.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stateDict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotPointObj</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># used to select points(s) in derived mmStackPlot and mmStackImage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myWinType</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotRunObj</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_on</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines_on</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="c1">#self.axes = self.figure.add_subplot(111)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="c1">#remove white border</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span> <span class="c1">#turn off axis labels</span>

        <span class="n">FigureCanvas</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

        <span class="n">FigureCanvas</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                   <span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span>
                                   <span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>
        <span class="n">FigureCanvas</span><span class="o">.</span><span class="n">updateGeometry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;key_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onkey</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onclick</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;scroll_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onscroll</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;pick_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onpick</span><span class="p">)</span>

        <span class="c1"># self.canvas.setFocusPolicy( Qt.ClickFocus )</span>
        <span class="c1"># self.canvas.setFocus()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setFocusPolicy</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ClickFocus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setFocus</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myScatterPlot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myLinePlot</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="mmCanvas.plot"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmCanvas.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stateDict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;All derived classes should over-ride this and have code to plot.</span>

<span class="sd">        stateDict: Dictionary describing what to plot. See mmApplication.getState()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="mmCanvas.onkey"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmCanvas.onkey">[docs]</a>    <span class="k">def</span> <span class="nf">onkey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s1">&#39;mmCanvas.onkey()&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span>

        <span class="c1">#</span>
        <span class="c1">#  pan the plot</span>
        <span class="n">xLim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="n">yLim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="n">xPercent</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xLim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xLim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.1</span>
        <span class="n">yPercent</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">yLim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">yLim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.1</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span>
            <span class="n">xLim</span> <span class="o">+=</span> <span class="n">xPercent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xLim</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span>
            <span class="n">xLim</span> <span class="o">-=</span> <span class="n">xPercent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xLim</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span>
            <span class="n">yLim</span> <span class="o">+=</span> <span class="n">yPercent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yLim</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;down&#39;</span><span class="p">:</span>
            <span class="n">yLim</span> <span class="o">-=</span> <span class="n">yPercent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yLim</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="c1">#</span>
        <span class="c1"># dynamics</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggledynamics</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">myScatterPlot</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">myScatterPlot</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">myScatterPlot</span><span class="o">.</span><span class="n">get_visible</span><span class="p">())</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">myLinePlot</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">myLinePlot</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">myLinePlot</span><span class="o">.</span><span class="n">get_visible</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;esc&#39;</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39;esc needs to cancel spine selection&#39;</span></div>

<div class="viewcode-block" id="mmCanvas.togglelines"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmCanvas.togglelines">[docs]</a>    <span class="k">def</span> <span class="nf">togglelines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">onoff</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Toggle lines connecting annotations between timepoint. Be carefull here on repeatedly plot these lines&quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="mmCanvas.toggledynamics"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmCanvas.toggledynamics">[docs]</a>    <span class="k">def</span> <span class="nf">toggledynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">onoff</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Turn dynamics marker color on and off&quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="mmCanvas.onclick"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmCanvas.onclick">[docs]</a>    <span class="k">def</span> <span class="nf">onclick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s1">&#39;mmCanvas.onclick()&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span></div>

<div class="viewcode-block" id="mmCanvas.onscroll"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmCanvas.onscroll">[docs]</a>    <span class="k">def</span> <span class="nf">onscroll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s1">&#39;mmCanvas.onscroll()&#39;</span></div>

<div class="viewcode-block" id="mmCanvas.receiveevent"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmCanvas.receiveevent">[docs]</a>    <span class="k">def</span> <span class="nf">receiveevent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s1">&#39;mmCanvas.receiveevent()&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span></div>

<div class="viewcode-block" id="mmCanvas.onpick"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmCanvas.onpick">[docs]</a>    <span class="k">def</span> <span class="nf">onpick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Respond to clicks in a map, stack, and image plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span> <span class="s1">&#39;mmCanvas.onpick()&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ind</span></div></div>

<div class="viewcode-block" id="mmMapPlotCanvas"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmMapPlotCanvas">[docs]</a><span class="k">class</span> <span class="nc">mmMapPlotCanvas</span><span class="p">(</span><span class="n">mmCanvas</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot and interact with a plot of stack values across a map&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">mmCanvas</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>

<div class="viewcode-block" id="mmMapPlotCanvas.togglelines"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmMapPlotCanvas.togglelines">[docs]</a>    <span class="k">def</span> <span class="nf">togglelines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">onoff</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Toggle lines connecting annotations between timepoint. Be carefull here on repeatedly plot these lines&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">onoff</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lines_on</span> <span class="o">=</span> <span class="n">onoff</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lines_on</span> <span class="o">=</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">lines_on</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines_on</span><span class="p">:</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">myLinePlot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xPlot</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">yPlot</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                                              <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
                                              <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">lines</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">line</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span></div>

<div class="viewcode-block" id="mmMapPlotCanvas.toggledynamics"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmMapPlotCanvas.toggledynamics">[docs]</a>    <span class="k">def</span> <span class="nf">toggledynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">onoff</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Turn dynamics marker color on and off&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">onoff</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_on</span> <span class="o">=</span> <span class="n">onoff</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_on</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_on</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_on</span><span class="p">:</span>
            <span class="c1"># color add/sub/transient/persistent</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">cNone</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
            <span class="n">cSubtract</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
            <span class="n">cAdd</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
            <span class="n">cTransient</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
            <span class="n">cPersistent</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>

            <span class="n">cMatrix</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yRunRow</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yRunRow</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                    <span class="n">currColor</span> <span class="o">=</span> <span class="n">cNone</span>
                    <span class="n">prev</span> <span class="o">=</span> <span class="s1">&#39;nan&#39;</span>
                    <span class="nb">next</span> <span class="o">=</span> <span class="s1">&#39;nan&#39;</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessIdx</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="nb">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessIdx</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">prev</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">currColor</span> <span class="o">=</span> <span class="n">cAdd</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">next</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">currColor</span> <span class="o">=</span> <span class="n">cSubtract</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">prev</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">next</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">currColor</span> <span class="o">=</span> <span class="n">cTransient</span>
                    <span class="k">if</span> <span class="n">prev</span> <span class="ow">and</span> <span class="nb">next</span><span class="p">:</span>
                        <span class="n">currColor</span> <span class="o">=</span> <span class="n">cPersistent</span>

                    <span class="n">cMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">currColor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cMatrix</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">myScatterPlot</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">cMatrix</span><span class="p">)</span></div>

<div class="viewcode-block" id="mmMapPlotCanvas.receiveevent"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmMapPlotCanvas.receiveevent">[docs]</a>    <span class="k">def</span> <span class="nf">receiveevent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s1">&#39;mmMapPlotCanvas.receiveevent()&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">map</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;spine selection&#39;</span><span class="p">:</span>
            <span class="c1"># for a map, we should select a run</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">myWinType</span> <span class="o">==</span> <span class="s1">&#39;map_plot&#39;</span><span class="p">:</span>
                <span class="c1">#xRun = self.xPlot[event.runMapRow, :]</span>
                <span class="c1">#yRun = self.yPlot[event.runMapRow, :]</span>
                <span class="n">xRun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myMapPlot</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">runMapRow</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">yRun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myMapPlot</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">runMapRow</span><span class="p">,</span> <span class="p">:]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotRunObj</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plotRunObj</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span><span class="n">xRun</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plotRunObj</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">yRun</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># this is assuming we only plotted one line</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plotRunObj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xRun</span><span class="p">,</span> <span class="n">yRun</span><span class="p">,</span> <span class="s1">&#39;yo-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="mmMapPlotCanvas.onkey"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmMapPlotCanvas.onkey">[docs]</a>    <span class="k">def</span> <span class="nf">onkey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s1">&#39;MyStaticMplCanvas.onkey()&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">mmMapPlotCanvas</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">onkey</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>

<div class="viewcode-block" id="mmMapPlotCanvas.onpick"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmMapPlotCanvas.onpick">[docs]</a>    <span class="k">def</span> <span class="nf">onpick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Respond to clicks in a map plot.</span>

<span class="sd">        event.ind: A list of hit points, just use the first.</span>
<span class="sd">        We are normally plotting self.runMap (a 2D nparray) with NaN.</span>
<span class="sd">        event.ind is index into this array AFTER nan has been stripped.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span> <span class="s1">&#39;mmMapPlotCanvas.onpick()&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ind</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">ind</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># strip nan, use this to find</span>
        <span class="c1">#yRunRow_noNan = self.yRunRow[~np.isnan(self.yRunRow)]</span>
        <span class="c1">#runMapRow = int(yRunRow_noNan[ind[0]])</span>

        <span class="n">sessIdx</span><span class="p">,</span> <span class="n">stackdbIdx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myMapPlot</span><span class="o">.</span><span class="n">getUserSelection</span><span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="nb">print</span> <span class="s1">&#39;sessIdx:&#39;</span><span class="p">,</span> <span class="n">sessIdx</span><span class="p">,</span> <span class="s1">&#39;stackdbIdx:&#39;</span><span class="p">,</span> <span class="n">stackdbIdx</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        sessIdx_noNan = self.sessIdx[~np.isnan(self.sessIdx)]</span>
<span class="sd">        sessIdx = int(sessIdx_noNan[ind[0]])</span>

<span class="sd">        stackdbIdx_noNan = self.stackdbIdx[~np.isnan(self.stackdbIdx)]</span>
<span class="sd">        stackdbIdx = int(stackdbIdx_noNan[ind[0]])</span>

<span class="sd">        # transmit selection event to all open windows</span>
<span class="sd">        newEvent = mmEvent(self.map, sessIdx, stackdbIdx)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">newEvent</span> <span class="o">=</span> <span class="n">mmEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">,</span> <span class="n">sessIdx</span><span class="p">,</span> <span class="n">stackdbIdx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">broadcastevent</span><span class="p">(</span><span class="n">newEvent</span><span class="p">)</span>

        <span class="n">statusStr</span> <span class="o">=</span> <span class="n">newEvent</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">setStatus</span><span class="p">(</span><span class="n">statusStr</span><span class="p">)</span></div>

<div class="viewcode-block" id="mmMapPlotCanvas.plot2"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmMapPlotCanvas.plot2">[docs]</a>    <span class="k">def</span> <span class="nf">plot2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stateDict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trying to get mmMapPlot working</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myPlotDict</span> <span class="o">=</span> <span class="n">stateDict</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">myWinType</span> <span class="o">=</span> <span class="s1">&#39;map_plot&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">myMapPlot</span> <span class="o">=</span> <span class="n">mmMapPlot2</span><span class="p">(</span><span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myMapPlot</span><span class="o">.</span><span class="n">plotMap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="n">stateDict</span><span class="p">)</span></div>

<div class="viewcode-block" id="mmMapPlotCanvas.plot"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmMapPlotCanvas.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stateDict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot mmStack values for all mmStack(s) in the map.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">myPlotDict</span> <span class="o">=</span> <span class="n">stateDict</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">myWinType</span> <span class="o">=</span> <span class="s1">&#39;map_plot&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]</span>

        <span class="n">stateDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">getMapValues3</span><span class="p">(</span><span class="n">stateDict</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xPlot</span> <span class="o">=</span> <span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yPlot</span> <span class="o">=</span> <span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stackdbIdx</span> <span class="o">=</span> <span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;stackidx&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sessIdx</span> <span class="o">=</span> <span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;mapsess&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yRunRow</span> <span class="o">=</span> <span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;runrow&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">myScatterPlot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xPlot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yPlot</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">picker</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;xstat&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;ystat&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="mmMapPlotCanvas.plotMap0"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmMapPlotCanvas.plotMap0">[docs]</a>    <span class="k">def</span> <span class="nf">plotMap0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stateDict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot a canonical map of pDist versus session.</span>

<span class="sd">        stateDict: Tells us map to plot</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">myPlotDict</span> <span class="o">=</span> <span class="n">stateDict</span>

        <span class="c1">## this should be in a common function mapPlot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myWinType</span> <span class="o">=</span> <span class="s1">&#39;map_plot&#39;</span>

        <span class="c1"># this is silly, we should be given a map on construction?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">myMapPlot</span> <span class="o">=</span> <span class="n">mmMapPlot2</span><span class="p">(</span><span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myMapPlot</span><span class="o">.</span><span class="n">plotMap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="n">stateDict</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        stateDict = self.map.getMapValues3(stateDict)</span>

<span class="sd">        self.xPlot = stateDict[&#39;x&#39;]</span>
<span class="sd">        self.yPlot = stateDict[&#39;y&#39;]</span>

<span class="sd">        # get spine angle and offset</span>
<span class="sd">        offset = 0.1</span>
<span class="sd">        cAngle = self.map.getMapValues2(&#39;cAngle&#39;, segmentID=stateDict[&#39;segmentid&#39;])</span>
<span class="sd">        self.xPlot[cAngle &gt; 180] += offset</span>
<span class="sd">        self.xPlot[cAngle &lt; 180] -= offset</span>

<span class="sd">        markersize = 10  # units here is area</span>
<span class="sd">        self.myScatterPlot = self.axes.scatter(self.xPlot, self.yPlot, marker=&#39;o&#39;, s=markersize, picker=True)</span>

<span class="sd">        self.toggledynamics(True)</span>
<span class="sd">        self.togglelines(True)</span>

<span class="sd">        # background colors</span>
<span class="sd">        grayLevel = 0.6</span>
<span class="sd">        backgroundColor = (grayLevel, grayLevel, grayLevel)</span>
<span class="sd">        rect = self.figure.patch</span>
<span class="sd">        rect.set_facecolor(backgroundColor)  # figure background color</span>
<span class="sd">        # this works for matplotlib 2.02 but not earlier as is on my laptop</span>
<span class="sd">        # #self.axes.set_facecolor(backgroundColor) #axes background color</span>

<span class="sd">        # remove frame</span>
<span class="sd">        self.axes.spines[&#39;top&#39;].set_visible(False)</span>
<span class="sd">        self.axes.spines[&#39;right&#39;].set_visible(False)</span>

<span class="sd">        self.axes.set_xlabel(stateDict[&#39;xstat&#39;])</span>
<span class="sd">        self.axes.set_ylabel(stateDict[&#39;ystat&#39;])</span>
<span class="sd">        &quot;&quot;&quot;</span></div></div>

<div class="viewcode-block" id="mmStackPlotCanvas"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmStackPlotCanvas">[docs]</a><span class="k">class</span> <span class="nc">mmStackPlotCanvas</span><span class="p">(</span><span class="n">mmCanvas</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot and interact with a plot of stack values across a map&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">mmCanvas</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>

<div class="viewcode-block" id="mmStackPlotCanvas.toggledynamics"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmStackPlotCanvas.toggledynamics">[docs]</a>    <span class="k">def</span> <span class="nf">toggledynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">onoff</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Turn dynamics marker color on and off&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">onoff</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_on</span> <span class="o">=</span> <span class="n">onoff</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_on</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamics_on</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        if self.dynamics_on:</span>
<span class="sd">            # color add/sub/transient/persistent</span>
<span class="sd">            alpha = 1</span>
<span class="sd">            cNone = (0, 0, 0, alpha)</span>
<span class="sd">            cSubtract = (1, 0, 0, alpha)</span>
<span class="sd">            cAdd = (0, 1, 0, alpha)</span>
<span class="sd">            cTransient = (0, 0, 1, alpha)</span>
<span class="sd">            cPersistent = (1, 1, 0, alpha)</span>

<span class="sd">            cMatrix = []</span>

<span class="sd">            m = self.yRunRow.shape[0]</span>
<span class="sd">            n = self.yRunRow.shape[1]</span>

<span class="sd">            for i in range(m):</span>
<span class="sd">                for j in range(n):</span>
<span class="sd">                    currColor = cNone</span>
<span class="sd">                    prev = &#39;nan&#39;</span>
<span class="sd">                    next = &#39;nan&#39;</span>
<span class="sd">                    if j &gt; 0:</span>
<span class="sd">                        prev = self.sessIdx[i][j - 1] &gt;= 0</span>
<span class="sd">                    if j &lt; n - 1:</span>
<span class="sd">                        next = self.sessIdx[i][j + 1] &gt;= 0</span>
<span class="sd">                    if not prev and j &gt; 0:</span>
<span class="sd">                        currColor = cAdd</span>
<span class="sd">                    if not next and j &lt; n - 1:</span>
<span class="sd">                        currColor = cSubtract</span>
<span class="sd">                    if not prev and not next and j &gt; 0 and j &lt; n - 1:</span>
<span class="sd">                        currColor = cTransient</span>
<span class="sd">                    if prev and next:</span>
<span class="sd">                        currColor = cPersistent</span>

<span class="sd">                    cMatrix.append(currColor)</span>
<span class="sd">        else:</span>
<span class="sd">            cMatrix = &#39;b&#39;</span>

<span class="sd">        self.myScatterPlot.set_color(cMatrix)</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="mmStackPlotCanvas.selectPoint"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmStackPlotCanvas.selectPoint">[docs]</a>    <span class="k">def</span> <span class="nf">selectPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stackdbIdx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Visually select a single point</span>

<span class="sd">        todo: extend this to take a list of points to select</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverseLookup</span><span class="p">[</span><span class="n">stackdbIdx</span><span class="p">]</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ind</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">xPnt</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xPlot</span><span class="p">[</span><span class="n">ind</span><span class="p">]]</span>
        <span class="n">yPnt</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">yPlot</span><span class="p">[</span><span class="n">ind</span><span class="p">]]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotPointObj</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotPointObj</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span><span class="n">xPnt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotPointObj</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">yPnt</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># this is assuming we only plotted one line</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotPointObj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xPnt</span><span class="p">,</span> <span class="n">yPnt</span><span class="p">,</span> <span class="s1">&#39;yo-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="mmStackPlotCanvas.receiveevent"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmStackPlotCanvas.receiveevent">[docs]</a>    <span class="k">def</span> <span class="nf">receiveevent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s1">&#39;mmStackPlotCanvas.receiveevent()&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">map</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">mapSession</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;sessidx&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;spine selection&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selectPoint</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">stackdbIdx</span><span class="p">)</span></div>

<div class="viewcode-block" id="mmStackPlotCanvas.onkey"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmStackPlotCanvas.onkey">[docs]</a>    <span class="k">def</span> <span class="nf">onkey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s1">&#39;mmStackPlotCanvas.onkey()&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">mmStackPlotCanvas</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">onkey</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>

<div class="viewcode-block" id="mmStackPlotCanvas.onpick"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmStackPlotCanvas.onpick">[docs]</a>    <span class="k">def</span> <span class="nf">onpick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Respond to clicks in a stack plot.</span>

<span class="sd">        event.ind: A list of hit points, just use the first.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span> <span class="s1">&#39;mmStackPlotCanvas.onpick()&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ind</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">ind</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">stackdbIdx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stackdbIdx_plot</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="c1"># transmit selection event to all open windows</span>
        <span class="n">newEvent</span> <span class="o">=</span> <span class="n">mmEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;sessidx&#39;</span><span class="p">],</span> <span class="n">stackdbIdx</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        newEvent = mmEvent()</span>
<span class="sd">        newEvent.type = &#39;spine selection&#39;</span>
<span class="sd">        newEvent.map = self.map</span>
<span class="sd">        newEvent.mapSession = self.stateDict[&#39;sessidx&#39;]</span>
<span class="sd">        newEvent.stack = None</span>
<span class="sd">        newEvent.stackdbIdx = stackdbIdx</span>
<span class="sd">        newEvent.runMapRow = None # we should not have to fill this in here</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">broadcastevent</span><span class="p">(</span><span class="n">newEvent</span><span class="p">)</span>

        <span class="c1">#statusStr = &#39;User Select: stackdbIdx:&#39; + str(stackdbIdx)</span>
        <span class="n">statusStr</span> <span class="o">=</span> <span class="n">newEvent</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">setStatus</span><span class="p">(</span><span class="n">statusStr</span><span class="p">)</span></div>

<div class="viewcode-block" id="mmStackPlotCanvas.plot"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmStackPlotCanvas.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stateDict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot mmStack values&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myWinType</span> <span class="o">=</span> <span class="s1">&#39;stack_plot&#39;</span>

        <span class="c1">#todo: get this into constructor of ALL plot window/canvas objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stateDict</span> <span class="o">=</span> <span class="n">stateDict</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;stack&#39;</span><span class="p">]</span>
        <span class="n">xStat</span> <span class="o">=</span> <span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;xstat&#39;</span><span class="p">]</span>
        <span class="n">yStat</span> <span class="o">=</span> <span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;ystat&#39;</span><span class="p">]</span>
        <span class="n">roiType</span> <span class="o">=</span> <span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;roitype&#39;</span><span class="p">]</span>
        <span class="n">segmentID</span> <span class="o">=</span> <span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;segmentid&#39;</span><span class="p">]</span>

        <span class="n">stateDict</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">getStackValues3</span><span class="p">(</span><span class="n">stateDict</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xPlot</span> <span class="o">=</span> <span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yPlot</span> <span class="o">=</span> <span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stackdbIdx_plot</span> <span class="o">=</span> <span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;stackidx&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reverseLookup</span> <span class="o">=</span> <span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;reverse&#39;</span><span class="p">]</span>

        <span class="c1">#we only get the values we are plotting here</span>
        <span class="c1">#self.xPlot, self.stackdbIdx_plot, self.reverseLookup = stack.getStackValues(xStat, roiType=roiType, segmentID=segmentID)</span>
        <span class="c1">#self.yPlot, tmp, tmp = stack.getStackValues(yStat, roiType=roiType, segmentID=segmentID)</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        #reverseLookup is same size as stackdb, for object i it gives us index into xPlot and yPlot</span>
<span class="sd">        self.reverseLookup = np.zeros(stack.numObj())</span>
<span class="sd">        self.reverseLookup[:] = np.NaN</span>
<span class="sd">        for i, val in enumerate(self.stackdbIdx_plot):</span>
<span class="sd">            if val &gt;= 0:</span>
<span class="sd">                self.reverseLookup[val] = i</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">myScatterPlot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xPlot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yPlot</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">picker</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xStat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">yStat</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="mmStackCanvas"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmStackCanvas">[docs]</a><span class="k">class</span> <span class="nc">mmStackCanvas</span><span class="p">(</span><span class="n">mmCanvas</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot and interact with a 3D images stack&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">mmCanvas</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sliceNumber</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="mmStackCanvas.onscroll"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmStackCanvas.onscroll">[docs]</a>    <span class="k">def</span> <span class="nf">onscroll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">myWinType</span> <span class="o">==</span> <span class="s1">&#39;stack_image&#39;</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="s1">&#39;up&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sliceNumber</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="s1">&#39;down&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sliceNumber</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># bounds check</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sliceNumber</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sliceNumber</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sliceNumber</span> <span class="o">&gt;</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sliceNumber</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">setSlice_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sliceNumber</span><span class="p">)</span></div>

<div class="viewcode-block" id="mmStackCanvas.onpick"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmStackCanvas.onpick">[docs]</a>    <span class="k">def</span> <span class="nf">onpick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Respond to clicks in a map, stack, and image plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span> <span class="s1">&#39;mmStackCanvas.onpick()&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ind</span>
        <span class="nb">print</span> <span class="s1">&#39;   ON PICK IS NOT WORKING FOR STACK IMAGE !!!!!&#39;</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        event.ind is a list of hit points, just use the first.</span>
<span class="sd">        We are normally plotting self.runMap (a 2D nparray) with NaN.</span>
<span class="sd">        event.ind is index into this array AFTER nan has been stripped.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ind</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">ind</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># self.stackdbIdx_plot is of type int, there can not be any nan with int</span>
        <span class="c1"># tmp = ~np.isnan(self.stackdbIdx_plot)</span>
        <span class="n">stackdbIdx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stackdbIdxMasked</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="c1"># if we are in a map, figure out runIdx? Or let the propogation function do this? Or the event class?</span>
        <span class="c1"># write mmStack.getObjectValue(stat) to retrieve (roiType, segmentID, x, y, z, etc)</span>

        <span class="c1">#self.selectPoint(stackdbIdx)</span>

        <span class="c1"># transmit selection event to all open windows</span>
        <span class="n">newEvent</span> <span class="o">=</span> <span class="n">mmEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;sessidx&#39;</span><span class="p">],</span> <span class="n">stackdbIdx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">broadcastevent</span><span class="p">(</span><span class="n">newEvent</span><span class="p">)</span>

        <span class="c1"># update status bar</span>
        <span class="n">statusStr</span> <span class="o">=</span> <span class="n">newEvent</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">setStatus</span><span class="p">(</span><span class="n">statusStr</span><span class="p">)</span></div>

<div class="viewcode-block" id="mmStackCanvas.toggledynamics"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmStackCanvas.toggledynamics">[docs]</a>    <span class="k">def</span> <span class="nf">toggledynamics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">onoff</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Need to write this for stack, see parent function&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="mmStackCanvas.selectPoint"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmStackCanvas.selectPoint">[docs]</a>    <span class="k">def</span> <span class="nf">selectPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stackdbIdx</span><span class="p">,</span> <span class="n">snap</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Visually select a single point</span>

<span class="sd">        todo: extend this to take a list of points to select</span>
<span class="sd">        todo: this will select points that may be masked out (we use self.xPlot/self.yPlot but are plotting self.xMasked/self.yMasked</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverseLookup</span><span class="p">[</span><span class="n">stackdbIdx</span><span class="p">]</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ind</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">xPnt</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xPlot</span><span class="p">[</span><span class="n">ind</span><span class="p">]]</span>
        <span class="n">yPnt</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">yPlot</span><span class="p">[</span><span class="n">ind</span><span class="p">]]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotPointObj</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotPointObj</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span><span class="n">xPnt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotPointObj</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">yPnt</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># this is assuming we only plotted one line</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotPointObj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xPnt</span><span class="p">,</span> <span class="n">yPnt</span><span class="p">,</span> <span class="s1">&#39;yo-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">snap</span><span class="p">:</span>
            <span class="n">zPnt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zPlot</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setSlice_</span><span class="p">(</span><span class="n">zPnt</span><span class="p">)</span> <span class="c1"># call draw()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="mmStackCanvas.receiveevent"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmStackCanvas.receiveevent">[docs]</a>    <span class="k">def</span> <span class="nf">receiveevent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s1">&#39;mmStackPlotCanvas.receiveevent()&#39;</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">map</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">mapSession</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;sessidx&#39;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;spine selection&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selectPoint</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">stackdbIdx</span><span class="p">)</span></div>

<div class="viewcode-block" id="mmStackCanvas.plot"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmStackCanvas.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stateDict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot a mmStack.images 3D image&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">myWinType</span> <span class="o">=</span> <span class="s1">&#39;stack_image&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stateDict</span> <span class="o">=</span> <span class="n">stateDict</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;stack&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliceNumber</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">loadStackImages</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">roiType</span> <span class="o">=</span> <span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;roitype&#39;</span><span class="p">]</span>
        <span class="n">segmentID</span> <span class="o">=</span> <span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;segmentid&#39;</span><span class="p">]</span>

        <span class="c1">#</span>
        <span class="c1">#  images</span>

        <span class="c1"># max project</span>
        <span class="c1"># self.maxProject = np.amax(self.stack.images, axis=0)</span>
        <span class="n">iLeft</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">iTop</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">iRight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">voxelx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># this only handles square images</span>
        <span class="n">iBottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">voxely</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># this only handles square images</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imgplot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">iLeft</span><span class="p">,</span> <span class="n">iRight</span><span class="p">,</span> <span class="n">iBottom</span><span class="p">,</span> <span class="n">iTop</span><span class="p">])</span>  <span class="c1"># l, r, b, t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;um&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;um&#39;</span><span class="p">)</span>

        <span class="nb">print</span> <span class="s1">&#39;image is of type:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">dtype</span>

        <span class="c1">#</span>
        <span class="c1">#  line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">getLine</span><span class="p">(</span><span class="n">segmentID</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_xyz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">markersize</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">myLinePlot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_xyz</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_xyz</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                                          <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">)</span>  <span class="c1"># , picker=True)</span>

        <span class="c1">#</span>
        <span class="c1">#  spines</span>
        <span class="n">ystat</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>
        <span class="n">xstat</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
        <span class="n">roiType</span> <span class="o">=</span> <span class="n">stateDict</span><span class="p">[</span><span class="s1">&#39;roitype&#39;</span><span class="p">]</span>

        <span class="n">plotDict</span> <span class="o">=</span> <span class="n">stateDict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">plotDict</span><span class="p">[</span><span class="s1">&#39;xstat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
        <span class="n">plotDict</span><span class="p">[</span><span class="s1">&#39;ystat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>
        <span class="n">plotDict</span><span class="p">[</span><span class="s1">&#39;zstat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;z&#39;</span>

        <span class="n">plotDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">getStackValues3</span><span class="p">(</span><span class="n">plotDict</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xPlot</span> <span class="o">=</span> <span class="n">plotDict</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yPlot</span> <span class="o">=</span> <span class="n">plotDict</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zPlot</span> <span class="o">=</span> <span class="n">plotDict</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stackdbIdx_plot</span> <span class="o">=</span> <span class="n">plotDict</span><span class="p">[</span><span class="s1">&#39;stackidx&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reverseLookup</span> <span class="o">=</span> <span class="n">plotDict</span><span class="p">[</span><span class="s1">&#39;reverse&#39;</span><span class="p">]</span>
        <span class="c1">#self.xPlot, self.stackdbIdx_plot, self.reverseLookup = self.stack.getStackValues(&#39;x&#39;, roiType=roiType, segmentID=segmentID)</span>
        <span class="c1">#self.yPlot, tmp, tmp = self.stack.getStackValues(&#39;y&#39;, roiType=roiType, segmentID=segmentID)</span>
        <span class="c1">#self.zPlot, tmp, tmp = self.stack.getStackValues(&#39;z&#39;, roiType=roiType, segmentID=segmentID)</span>

        <span class="n">markersize</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">myScatterPlot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xPlot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yPlot</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">picker</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setSlice_</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>

        <span class="c1">#</span>
        <span class="c1"># annotate</span>
        <span class="c1"># legendStr = self.stack.name</span>
        <span class="c1"># self.annotation = self.ax.annotate(legendStr, xy=(0,-20))</span>

        <span class="c1"># self.draw()</span>

<div class="viewcode-block" id="mmStackCanvas.setSliceContrast"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmStackCanvas.setSliceContrast">[docs]</a>    <span class="k">def</span> <span class="nf">setSliceContrast</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sliceNumber</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">maxInt</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">lowContrast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">lowContrast</span>
        <span class="n">highContrast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">highContrast</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="n">maxInt</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">highContrast</span> <span class="o">-</span> <span class="n">lowContrast</span><span class="p">)</span>

        <span class="c1">#img.astype(numpy.uint16)</span>
        <span class="n">img</span><span class="p">[</span><span class="n">img</span> <span class="o">&lt;</span> <span class="n">lowContrast</span><span class="p">]</span> <span class="o">=</span> <span class="n">lowContrast</span>
        <span class="n">img</span><span class="p">[</span><span class="n">img</span> <span class="o">&gt;</span> <span class="n">highContrast</span><span class="p">]</span> <span class="o">=</span> <span class="n">highContrast</span>
        <span class="n">img</span> <span class="o">-=</span> <span class="n">lowContrast</span>
        <span class="n">img</span> <span class="o">*=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mult</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">imgplot</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">img</span><span class="p">)</span></div>

<div class="viewcode-block" id="mmStackCanvas.setSlice_"><a class="viewcode-back" href="../../../pymapmanager.interface.mmCanvas.html#pymapmanager.interface.mmCanvas.mmStackCanvas.setSlice_">[docs]</a>    <span class="k">def</span> <span class="nf">setSlice_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sliceNum</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the slice when canvas is displaying a mmStack&quot;&quot;&quot;</span>
        <span class="c1"># error check</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">sliceNum</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sliceNum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">sliceNum</span> <span class="o">&gt;</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">sliceNum</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#</span>
            <span class="c1"># image</span>
            <span class="c1">#self.imgplot.set_data(self.stack.images[sliceNum, :, :])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setSliceContrast</span><span class="p">()</span>

            <span class="n">upperz</span> <span class="o">=</span> <span class="n">sliceNum</span> <span class="o">-</span> <span class="mi">5</span>
            <span class="n">lowerz</span> <span class="o">=</span> <span class="n">sliceNum</span> <span class="o">+</span> <span class="mi">5</span>

            <span class="c1"># set_offsets() to set position of x/y scatter</span>
            <span class="c1"># set_array() to set color</span>
            <span class="c1"># for use of set_offsets, see:</span>
            <span class="c1">#    https://brushingupscience.wordpress.com/2016/06/21/matplotlib-animations-the-easy-way/</span>

            <span class="c1">#</span>
            <span class="c1"># stackdb points</span>
            <span class="c1"># We need to keep track of the mask we are plotting with so onpick ind[0] works</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zMask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_outside</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zPlot</span><span class="p">,</span> <span class="n">upperz</span><span class="p">,</span> <span class="n">lowerz</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xMasked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xPlot</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">zMask</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yMasked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yPlot</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">zMask</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stackdbIdxMasked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stackdbIdx_plot</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">zMask</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s1">&#39;ERROR: mmStackCanvas.setSlice_&#39;</span>

            <span class="c1"># set_offsets must be passed an Nx2 array. Here we use np.c_[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">myScatterPlot</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xMasked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yMasked</span><span class="p">])</span>

            <span class="c1">#</span>
            <span class="c1"># line</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_xyz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">zMask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_outside</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_xyz</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">upperz</span><span class="p">,</span> <span class="n">lowerz</span><span class="p">)</span>
                <span class="n">xMasked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_xyz</span><span class="p">[</span><span class="o">~</span><span class="n">zMask</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">yMasked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_xyz</span><span class="p">[</span><span class="o">~</span><span class="n">zMask</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

                <span class="c1"># set_offsets must be passed an Nx2 array. Here we use np.c_[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">myLinePlot</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">xMasked</span><span class="p">,</span> <span class="n">yMasked</span><span class="p">])</span>

            <span class="c1"># legendStr = self.stack.name + &#39; &#39; + str(sliceNum) + &#39;/&#39; + str(k)</span>
            <span class="c1"># self.annotation.set_text(legendStr)</span>

            <span class="c1">#</span>
            <span class="c1"># refresh</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div></div>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Robert H Cudmore.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'a1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: ''
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>